document.addEventListener("DOMContentLoaded", () => {
  const fullStar = `
    <svg width="19" height="18" viewBox="0 0 19 18" fill="#FFC83E" xmlns="http://www.w3.org/2000/svg" class="testimonial__star">
      <path d="M18.5746 6.45179C18.4573 6.09105 18.1373 5.83564 
      17.7603 5.80153L12.6175 5.33463L10.585 0.576206C10.4349 
      0.22661 10.0935 0.000976562 9.71345 0.000976562C9.3334 
      0.000976562 8.99183 0.22661 8.84272 0.576206L6.81025 
      5.33463L1.66662 5.80153C1.28956 5.83632 0.970279 6.09172 
      0.852297 6.45179C0.734994 6.81253 0.843326 7.2082 
      1.12849 7.4583L5.01605 10.8671L3.86981 15.9156C3.78594 
      16.2868 3.93002 16.6707 4.23802 16.8933C4.40358 17.0136 
      4.59809 17.0737 4.79327 17.0737C4.961 17.0737 5.12887 
      17.0291 5.27879 16.9394L9.71345 14.2878L14.1473 
      16.9394C14.4725 17.1338 14.8815 17.116 15.1889 
      16.8933C15.4969 16.6707 15.641 16.2868 15.5571 
      15.9156L14.4108 10.8671L18.2984 7.4583C18.5834 
      7.2082 18.6919 6.81334 18.5746 6.45179Z"/>
    </svg>`;

  const halfStar = `
    <svg width="19" height="18" viewBox="0 0 19 18" xmlns="http://www.w3.org/2000/svg" class="testimonial__star">
      <defs>
        <linearGradient id="half-fill">
          <stop offset="50%" stop-color="#FFC83E"/>
          <stop offset="50%" stop-color="#E0E0E0"/>
        </linearGradient>
      </defs>
      <path d="M18.5746 6.45179C18.4573 6.09105 18.1373 5.83564 
      17.7603 5.80153L12.6175 5.33463L10.585 0.576206C10.4349 
      0.22661 10.0935 0.000976562 9.71345 0.000976562C9.3334 
      0.000976562 8.99183 0.22661 8.84272 0.576206L6.81025 
      5.33463L1.66662 5.80153C1.28956 5.83632 0.970279 6.09172 
      0.852297 6.45179C0.734994 6.81253 0.843326 7.2082 
      1.12849 7.4583L5.01605 10.8671L3.86981 15.9156C3.78594 
      16.2868 3.93002 16.6707 4.23802 16.8933C4.40358 17.0136 
      4.59809 17.0737 4.79327 17.0737C4.961 17.0737 5.12887 
      17.0291 5.27879 16.9394L9.71345 14.2878L14.1473 
      16.9394C14.4725 17.1338 14.8815 17.116 15.1889 
      16.8933C15.4969 16.6707 15.641 16.2868 15.5571 
      15.9156L14.4108 10.8671L18.2984 7.4583C18.5834 
      7.2082 18.6919 6.81334 18.5746 6.45179Z" fill="url(#half-fill)"/>
    </svg>`;

  const emptyStar = `
    <svg width="19" height="18" viewBox="0 0 19 18" fill="#E0E0E0" xmlns="http://www.w3.org/2000/svg" class="testimonial__star">
      <path d="M18.5746 6.45179C18.4573 6.09105 18.1373 5.83564 
      17.7603 5.80153L12.6175 5.33463L10.585 0.576206C10.4349 
      0.22661 10.0935 0.000976562 9.71345 0.000976562C9.3334 
      0.000976562 8.99183 0.22661 8.84272 0.576206L6.81025 
      5.33463L1.66662 5.80153C1.28956 5.83632 0.970279 6.09172 
      0.852297 6.45179C0.734994 6.81253 0.843326 7.2082 
      1.12849 7.4583L5.01605 10.8671L3.86981 15.9156C3.78594 
      16.2868 3.93002 16.6707 4.23802 16.8933C4.40358 17.0136 
      4.59809 17.0737 4.79327 17.0737C4.961 17.0737 5.12887 
      17.0291 5.27879 16.9394L9.71345 14.2878L14.1473 
      16.9394C14.4725 17.1338 14.8815 17.116 15.1889 
      16.8933C15.4969 16.6707 15.641 16.2868 15.5571 
      15.9156L14.4108 10.8671L18.2984 7.4583C18.5834 
      7.2082 18.6919 6.81334 18.5746 6.45179Z"/>
    </svg>`;

  function renderStars(rating) {
    const full = Math.floor(rating);
    const hasHalf = rating % 1 >= 0.5;
    const empty = 5 - full - (hasHalf ? 1 : 0);

    return fullStar.repeat(full) + (hasHalf ? halfStar : "") + emptyStar.repeat(empty);
  }

  document.querySelectorAll('.testimonial__user_rating').forEach(block => {
    const rating = parseFloat(block.dataset.rating) || 0;
    const starsContainer = block.querySelector('.testimonial__stars');
    if (starsContainer) {
      starsContainer.innerHTML = renderStars(rating);
    }
  });
});
